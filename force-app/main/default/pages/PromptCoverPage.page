<apex:page controller="PromptStatsController">
  <apex:sectionHeader title="Prompt Engineering: sf-prompts" />
  <apex:pageBlock title="Project Statistics">
    <apex:pageBlockSection columns="2">
      <apex:pageBlockSectionItem>
        <apex:outputLabel value="Total Prompts" for="totalPrompts" />
        <apex:outputText id="totalPrompts" value="{!totalPrompts}" />
      </apex:pageBlockSectionItem>
      <apex:pageBlockSectionItem>
        <apex:outputLabel value="Total Answers" for="totalAnswers" />
        <apex:outputText id="totalAnswers" value="{!totalAnswers}" />
      </apex:pageBlockSectionItem>
    </apex:pageBlockSection>
  </apex:pageBlock>

  <apex:pageBlock title="Welcome to the Prompt Engineering App">
    <apex:outputText>
      <h2 style="font-size:3em; margin-bottom: 1em;">Welcome!</h2>
      <p>
        <img style="margin-bottom: 1em;" src="https://salesforcedevops.net/wp-content/uploads/2023/06/SalesforceDevops.net_An_icon_that_is_robot_with_a_wrench_in_one_cd929c3e-0e77-46d6-817b-f53f34b73c99.jpg"
          alt="Welcome image" height="256" width="265" />
      </p>
      <p style="font-size:1.5em;margin-bottom: 1em;">We are glad you are here. The Prompt Engineering App enables you to interact with the OpenAI API, create and store
        prompts, and receive AI-generated responses. Check the statistics above to see the current system usage. Happy prompting!
      </p>
      <h2 style="font-size:2em;margin-bottom: 1em;">Getting Started</h2>
      <p>&nbsp;</p>
      <h3 style="font-size:1.5em;margin-bottom: 1em;">Get OpenAPI Key and Org ID</h3>
      <ol style="font-size:1.5em;">
        <li>
          <a href="https://platform.openai.com/">Go to the OpenAI website</a> and sign up for an API account. You can get a free tier account, but you will be restricted
          in the number of API calls you can make. And you'll be restricted to the gpt-3.5-turbo model.</li>
        <li>
          <a href="https://platform.openai.com/account/api-keys">Visit the API keys page</a> and generate a new key for this project. Keep it in a safe place, and don't put it
          in any repository.</li>
        <li>
          <a href="https://platform.openai.com/account/org-settings">Visit the Organization settings page</a> and copy the Organization ID. You'll need this later.</li>
      </ol>

      <p style="font-size:1.5em;margin-bottom: 1em;">Once you have your API key and Organization ID, you can install the sf-prompts package and start using it.</p>

      <p style="font-size:1.5em;margin-bottom: 1em;">More Information:
        <a href="https://salesforcedevops.net/prompt-engineering-app">https://salesforcedevops.net/prompt-engineering-app</a>
      </p>
      <h3 style="font-size:2em; margin-bottom: 1em;">Create External Credential</h3>
      <p style="font-size:1.5em;margin-bottom: 1em;">
        This is the rather lengthy procedure for storing the OpenAI API Key and Org ID in Salesforce. It is necessary because Named
        Credentials do not support custom authentication parameters. So, we have to create an External Credential to store
        the API key and then reference the External Credential in the Named Credential. I managed to pre-load part of the
        External Credential in the GitHub metadata, but the rest needs to set up manually. Here is the Salesforce documentation:
        <a href="https://help.salesforce.com/s/articleView?id=sf.external_services_define_named_credential.htm">https://help.salesforce.com/s/articleView?id=sf.external_services_define_named_credential.htm</a>.
      </p>
      <h3 style="font-size:1.5em;margin-bottom: 1em;">Create Permission Set Mapping</h3>
      <ol style="font-size:1.5em;">
        <li>From the VS Code terminal, enter the command "make open" to go to the scratch org setup page.</li>
        <li>Enter "named" in the Quick Find box and select Named Credentials.</li>
        <li>Click on the External Credentials tab.</li>
        <li>Click on the OpenAI External Credential item to edit its details.</li>
        <li>Click on down arrow in the Actions column next to Prompt Engineering and select Edit.</li>
        <li>Click Add on Authentication Parameters.</li>
        <li>Under Parameter 1, enter "apiKey" for the Name.</li>
        <li>Enter the OpenAI API key you generated in the previous section for the Value.</li>
        <li>Click Add on Authentication Parameters to add your organization id as the second parameter.</li>
        <li>Under Parameter 2, enter "Org" for the Name and enter your Organization ID for the Value.</li>
        <li>Click Save for Permission Set Mappings.</li>
        <li>Close the Permission Set Mapping window and then refresh your page to avoid any Salesforce behavior anomolies.</li>
      </ol>
      <h3 style="font-size:1.5em;margin-bottom: 1em;">Create Custom Headers</h3>
      <p style="font-size:1.5em;margin-bottom: 1em;">
        You need to create three custom header records within the External Credential. This is necessary because the OpenAI API requires
        three custom headers to be sent with each request. Here are the three headers. They use the specific names and values
        from prior steps, so be sure you followed those instructions exactly.
      </p>
      <table style="font-size:1.5em;margin-bottom: 1em;">
        <tr>
          <th>Header Name</th>
          <th>Header Value</th>
        </tr>
        <tr>
          <td>Content-Type</td>
          <td>application/json</td>
        </tr>
        <tr>
          <td>OpenAI-Organization</td>
          <td>&#123;!$Credential.OpenAI.Org&#125;</td>
        </tr>
        <tr>
          <td>Authorization</td>
          <td>Bearer &#123;!$Credential.OpenAI.apiKey&#125;</td>
        </tr>
      </table>
      <p style="font-size:1.5em;margin-bottom: 1em;">
        Follow these steps to create the custom headers:
      </p>
      <ol style="font-size:1.5em;">
        <li>Click on New on Custom Headers.</li>
        <li>Copy the first Header Name and Header Value from the table above.</li>
        <li>Click Save</li>
        <li>Repeat steps 1-3 for the other two headers.</li>
      </ol>
      <h3 style="font-size:1.5em;margin-bottom: 1em;">Create Named Credential</h3>
      <ol style="font-size:1.5em;">
        <li>Click on the `Named Credentials` label a the top of the page and then click on `Named Credenitals` tab to return
          to the list of Named Credentials.</li>
        <li>Click New on Named Credentials.</li>
        <li>Enter `OpenAIChat` for the Label and Name.</li>
        <li>Enter `https://api.openai.com/v1/chat/completions` for the URL.</li>
        <li>Click in the External Credential field and select `OpenAI`.</li>
        <li>Unclick the `Generate Authorization Header` checkbox.</li>
        <li>Click `Allow Formulas in HTTP Header` checkbox.</li>
        <li>Click Save.</li>
      </ol>
      <p style="font-size:1.5em;margin-bottom: 1em;">
        Congratulations! You have completed the setup required to use the OpenAI API from within you Salesforce org, and your API
        key is safely stored in Salesforce. You are ready to start using the sample prompts.
      </p>
    </apex:outputText>
  </apex:pageBlock>

</apex:page>